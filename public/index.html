<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airborn - Sistema de Inventario</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <h1 id="appName">üõçÔ∏è MI COMERCIO</h1>
                    <p>Sistema de Gesti√≥n de Inventario</p>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="usuarioActual" style="color: rgba(255,255,255,0.8); font-size: 0.9em;"></span>
                    <button class="admin-btn" onclick="abrirAdmin()">
                        ‚öôÔ∏è Admin
                    </button>
                    <button class="admin-btn" onclick="cerrarSesion()" style="background: rgba(231,76,60,0.3); border-color: rgba(231,76,60,0.5);">
                        üö™ Salir
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Modal Admin -->
    <div id="adminModal" class="admin-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h2>‚öôÔ∏è Panel de Administraci√≥n</h2>
                <button class="admin-modal-close" onclick="cerrarAdmin()">√ó</button>
            </div>
            <div class="admin-modal-body">
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="switchAdminTab('config', event)">üè∑Ô∏è Configuraci√≥n</button>
                    <button class="admin-tab" onclick="switchAdminTab('datos', event)">üóÉÔ∏è Datos</button>
                    <button class="admin-tab" onclick="switchAdminTab('backups', event)">üíæ Backups</button>
                </div>

                <!-- Tab Configuraci√≥n -->
                <div id="adminConfig" class="admin-tab-content active">
                    <div class="app-name-section">
                        <label>Nombre de la aplicaci√≥n</label>
                        <input type="text" id="inputAppName" placeholder="Ej: Mi Tienda">
                        <button onclick="guardarNombreApp()" style="background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            üíæ Guardar nombre
                        </button>
                    </div>
                </div>

                <!-- Tab Gesti√≥n de Datos -->
                <div id="adminDatos" class="admin-tab-content">
                    <div style="margin-bottom: 20px;">
                        <strong>Gesti√≥n de Datos</strong>
                        <p style="color: #666; font-size: 0.9em; margin-top: 4px;">Elimin√° datos espec√≠ficos sin afectar el resto. Siempre se crea un backup antes de borrar.</p>
                    </div>
                    
                    <div id="datosStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
                        <!-- Se llena con JS -->
                    </div>

                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="margin-bottom: 15px; color: #333;">üóëÔ∏è Limpiar Ventas por Per√≠odo</h4>
                        <div style="display: flex; gap: 10px; align-items: end; flex-wrap: wrap;">
                            <div>
                                <label style="display: block; font-size: 0.85em; margin-bottom: 5px;">Mes</label>
                                <select id="limpiarMes" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                                    <option value="1">Enero</option>
                                    <option value="2">Febrero</option>
                                    <option value="3">Marzo</option>
                                    <option value="4">Abril</option>
                                    <option value="5">Mayo</option>
                                    <option value="6">Junio</option>
                                    <option value="7">Julio</option>
                                    <option value="8">Agosto</option>
                                    <option value="9">Septiembre</option>
                                    <option value="10">Octubre</option>
                                    <option value="11">Noviembre</option>
                                    <option value="12" selected>Diciembre</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.85em; margin-bottom: 5px;">A√±o</label>
                                <input type="number" id="limpiarAnio" value="2025" min="2020" max="2030" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd; width: 80px;">
                            </div>
                            <button onclick="limpiarVentasMes()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                üóëÔ∏è Eliminar ventas del mes
                            </button>
                        </div>
                        <div id="resultadoLimpiarMes" style="margin-top: 10px;"></div>
                    </div>

                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffc107;">
                        <h4 style="margin-bottom: 10px; color: #856404;">‚ö†Ô∏è Zona de peligro</h4>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="resetearStockCero()" style="background: #f39c12; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold;">
        üìâ Poner todo el Stock en 0
    </button>
                            <button onclick="limpiarTabla('ventas')" style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                                Borrar TODAS las ventas
                            </button>
                            <button onclick="limpiarTabla('cambios')" style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                                Borrar TODOS los cambios
                            </button>
                            <button onclick="limpiarTabla('cuentas')" style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                                Borrar TODAS las cuentas corrientes
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tab Backups -->
                <div id="adminBackups" class="admin-tab-content">
                    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>Historial de cambios</strong>
                            <p style="color: #666; font-size: 0.9em; margin-top: 4px;">Cada acci√≥n genera un backup autom√°tico. Pod√©s restaurar a cualquier punto anterior.</p>
                        </div>
                        <button onclick="cargarBackups()" style="background: #3498db; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer;">
                            üîÑ Actualizar
                        </button>
                    </div>
                    <div id="backupLog" class="backup-log">
                        <div class="backup-empty">Cargando backups...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- NAVEGACI√ìN TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('busqueda', event)">üîç Buscar Precios</button>
            <button class="tab-btn" onclick="switchTab('cajas', event)">üìä Cajas Diarias</button>
            <button class="tab-btn" onclick="switchTab('stock', event)">üì¶ Stock</button>
            <button class="tab-btn" onclick="switchTab('cuentas', event)">üí∞ Cuentas Corrientes</button>
            <button class="tab-btn" onclick="switchTab('promedios', event)">üìà Promedios</button>
            <button class="tab-btn" onclick="switchTab('historico', event)">Hist√≥rico de Ventas</button>
        </div>

        <!-- ==================== TAB 1: B√öSQUEDA ====================-->
        <div id="busqueda" class="tab-content active">
            <div class="card">
                <h2>Buscar Producto por C√≥digo</h2>
                <div class="form-group input-search">
                    <input type="text" id="busquedaInput" placeholder="Buscar por c√≥digo o descripci√≥n..." autofocus>
                    <span class="search-icon">üîç</span>
                </div>
                <div id="busquedaResultado"></div>
            </div>
        </div>

        <!-- TAB 2 CAJAS DIARIAS -->
<div id="cajas" class="tab-content">

<!-- Selector de mes y d√≠as -->
    <div style="margin-top: 40px; margin-bottom: 20px;">
        <h3 id="mesActualTitulo" style="color: #333; margin-bottom: 15px;"></h3>
        <div id="diasDelMes" class="dias-grid"></div>
    </div>

  <!-- BOX MODO OSCURO: Registro de Venta -->
    <div class="venta-box-dark">
        <h3 class="venta-box-title">üíº Registrar Nueva Venta</h3>
        
        <!-- B√∫squeda r√°pida -->
        <div class="search-box">
            <input type="text" id="busquedaRapida" class="search-input-dark" placeholder="üîç Buscar por c√≥digo o descripci√≥n...">
            <div id="resultadoRapido"></div>
        </div>

        <!-- Formulario de venta en l√≠nea -->
        <div class="venta-form-inline" style="display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-end;">
    
    <div class="form-field" style="width: 130px;">
        <label>Fecha</label>
        <input type="date" id="fecha" required>
    </div>

    <div class="form-field" style="width: 140px;">
        <label>Art√≠culo</label>
        <input type="text" id="articulo" placeholder="C√≥digo" required>
    </div>

    <div class="form-field" style="width: 70px;">
        <label>Cant.</label>
        <input type="number" id="cantidad" value="1" required style="text-align: center;">
    </div>

    <div class="form-field" style="width: 110px;">
        <label>Precio</label>
        <input type="number" id="precio" step="0.01" placeholder="0.00" required>
    </div>

    <div class="form-field" style="width: 80px;">
        <label>Desc.</label>
        <select id="descuento">
            <option value="0">0%</option>
            <option value="5">5%</option>
            <option value="10">10%</option>
            <option value="15">15%</option>
            <option value="20">20%</option>
            <option value="25">25%</option>
            <option value="30">30%</option>
            <option value="35">35%</option>
            <option value="40">40%</option>
            <option value="50">50%</option>
        </select>
    </div>

    <div class="form-field total-field" style="width: 130px;">
        <label>Total</label>
        <div id="totalACobrar" class="total-display">$0.00</div>
    </div>

    <div class="form-field" style="width: 100px;">
        <label>Cat.</label>
        <input type="text" id="categoria" readonly>
    </div>

    <div class="form-field" style="width: 90px;">
        <label>Factura</label>
        <div class="factura-select">
            <button type="button" class="factura-btn active" data-value="A">A</button>
            <button type="button" class="factura-btn" data-value="B">B</button>
        </div>
    </div>

    <div class="form-field" style="flex: 1; min-width: 140px;">
        <label>Pago</label>
        <select id="tipoPago">
            <option value="Otro" selected>Otro...</option>
            <option value="Efectivo">Efectivo</option>
            <option value="Transferencia">Transferencia</option>
            <option value="Tarjeta Cr√©dito">T. Cr√©dito</option>
            <option value="Tarjeta D√©bito">T. D√©bito</option>
            <option value="MP">MercadoPago</option>
            <option value="MODO">MODO</option>
            <option value="CDNI">CDNI</option>
            <option value="QR">QR</option>
            <option value="Cheque">Cheque</option>
            <option value="Cta Cte">Cta Corriente</option>
        </select>
    </div>

    <div style="width: 100%; display: flex; align-items: center; gap: 15px; margin-top: 5px;">
        <div class="form-field" style="flex: 1;">
            <input type="text" id="comentarios" placeholder="Comentarios opcionales..." style="width: 100%;">
        </div>
        
        <div class="form-field">
            <div class="checkbox-container">
                <input type="checkbox" id="esCambio" style="width: 18px; height: 18px; margin: 0; cursor: pointer;">
                <label for="esCambio" style="color: #e74c3c; cursor: pointer; font-weight: bold; margin: 0; font-size: 0.9em; text-transform: uppercase;">Devoluci√≥n</label>
            </div>
        </div>
    </div>
</div>

        <button class="btn-registrar-dark" onclick="registrarVenta(event)">‚úì Registrar Venta</button>
    </div>

    <!-- Lista de ventas del d√≠a seleccionado -->
    <div class="ventas-list">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 id="ventasDiaTitulo" style="margin: 0;">Ventas del d√≠a</h3>
            <div style="display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 8px;">
                <label style="color: #000000; font-size: 0.9em; margin: 0;">Caja inicial:</label>
                <input type="text" id="cajaInicial" placeholder="$0" 
                    style="width: 120px; padding: 6px 10px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.2); color: white; text-align: right; font-weight: bold;"
                    onblur="guardarCajaInicial()" 
                    onkeyup="formatearInputMoneda(this); if(event.key === 'Enter') { this.blur(); }">
            </div>
        </div>
        <div id="listaVentas"></div>
    </div>
</div>

<!-------------- TAB 3 STOCK ---------------->
<div id="stock" class="tab-content">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0;">Actualizar Stock y Precios</h2>
            <button onclick="abrirModalProducto('')" style="background: #27ae60; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                ‚ú® Agregar Art√≠culo Nuevo
            </button>
        </div>

        <!-- BOX OSCURO: b√∫squeda + edici√≥n -->
        <div class="stock-box-dark">

            <!-- B√∫squeda por c√≥digo -->
            <div class="form-group">
                <label>Buscar por c√≥digo de art√≠culo</label>
                <div class="input-search">
                    <input type="text" id="stockBusquedaCodigo" placeholder="Buscar por c√≥digo o descripci√≥n...">
                    <span class="search-icon">üîç</span>
                </div>
                <div id="stockBusquedaResultado" class="error-text" style="display:none;"></div>
            </div>

            <!-- Panel de edici√≥n de producto -->
            <div id="stockEditor" class="stock-editor" style="display:none;">
                <h3 id="stockProductoTitulo"></h3>

                <div class="stock-editor-grid">
                    <div class="stock-field">
                        <label>C√≥digo</label>
                        <div id="stockCodigo" class="stock-value"></div>
                    </div>
                    <div class="stock-field">
                        <label>Categor√≠a</label>
                        <div id="stockCategoria" class="stock-value"></div>
                    </div>
                    <div class="stock-field">
                        <label>Precio P√∫blico</label>
                        <input type="number" id="stockPrecioPublico" step="0.01">
                    </div>
                    <div class="stock-field">
                        <label>Costo</label>
                        <input type="number" id="stockCosto" step="0.01">
                    </div>
                    <div class="stock-field">
                        <label>Stock actual</label>
                        <div id="stockActual" class="stock-value"></div>
                    </div>
                    <div class="stock-field">
                        <label>Cantidad a agregar / sacar</label>
                        <input type="number" id="stockDelta" step="1" value="0">
                    </div>
                    <div class="stock-field">
                        <label>Stock final</label>
                        <div id="stockFinal" class="stock-value"></div>
                    </div>
                </div>

                <button class="btn btn-success" onclick="guardarStockYPrecios()">üíæ Guardar cambios</button>
                <div id="stockEditorMensaje" class="error-text" style="margin-top:10px; display:none;"></div>
            </div>
        </div> <!-- /stock-box-dark -->

        <hr style="margin: 30px 0;">

        <!-- BOX CLARO: resumen + listado -->
        <div class="stock-box-light">
            <!-- Resumen de stock -->
            <div class="stock-resumen-top">
    <h3>Detalle de stock total</h3>
    <div id="stockResumenTotal" class="stock-resumen-total"></div>
</div>
<div id="stockResumen" class="stock-resumen"></div>

            <!-- Filtros y tabla de productos -->
            <div class="stock-list-header">
                <h3>Listado completo de art√≠culos</h3>
                <div class="stock-filtros">
                    <select id="filtroCategoria">
                        <option value="">Todas las categor√≠as</option>
                    </select>
                    <input type="text" id="filtroTexto" placeholder="Filtrar por descripci√≥n o c√≥digo...">
                </div>
            </div>

            <div class="stock-tabla-wrapper">
                <table class="stock-tabla" id="stockTabla">
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Descripci√≥n</th>
                            <th>Categor√≠a</th>
                            <th class="num">Precio P√∫blico</th>
                            <th class="num">Costo</th>
                            <th class="num">Stock</th>
                        </tr>
                    </thead>
                    <tbody id="stockTablaBody">
                        <!-- filas din√°micas -->
                    </tbody>
                </table>
            </div>
        </div> <!-- /stock-box-light -->

        <!-- BOX PEQUE√ëO: importar/actualizar productos por CSV -->
        <div class="stock-box-csv">
            <h3>üì¶ Importar Productos CSV</h3>
            <p class="stock-csv-text">
                <strong>Primera vez:</strong> Carg√° tu archivo con todos los productos.<br>
                Formato: <code>codigo,descripcion,categoria,precioPublico,costo,stock</code>
            </p>

            <div class="upload-area" onclick="document.getElementById('csvProductos').click()">
                <div class="icon">üìÅ</div>
                <p><strong>Click para importar productos</strong></p>
                <p style="font-size: 0.9em; color: #999; margin-top: 10px;">
                    Crea productos nuevos o actualiza existentes
                </p>
                <input type="file" id="csvProductos" accept=".csv" onchange="importarProductosCSV()" style="display:none;">
            </div>
            <div id="alertaProductos" class="alert"></div>

            <hr style="margin: 20px 0; border: none; border-top: 1px dashed #ddd;">

            <h3>üîÑ Actualizar Solo Stock</h3>
            <p class="stock-csv-text">
                Usa esta opci√≥n para actualizar cantidades. Formato: <code>codigo,cantidad</code>
            </p>

            <div style="margin-bottom: 15px; background: #fff; padding: 10px; border-radius: 6px; border: 1px solid #ddd;">
                <label style="font-weight: bold; margin-bottom: 5px; display: block;">¬øQu√© debe hacer el sistema?</label>
                <div style="display: flex; gap: 15px;">
                    <label style="cursor: pointer; display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="modoStock" value="replace" checked> 
                        üìù Corregir (Reemplazar stock)
                    </label>
                    <label style="cursor: pointer; display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="modoStock" value="add"> 
                        ‚ûï Sumar (Agregar al actual)
                    </label>
                </div>
            </div>

            <div class="upload-area" onclick="document.getElementById('csvFile').click()">
                <div class="icon">üìä</div>
                <p><strong>Click para subir CSV</strong></p>
                <input type="file" id="csvFile" accept=".csv" onchange="uploadCSV()" style="display:none;">
            </div>

            <div id="alertaStock" class="alert"></div>
            <div id="resultadoStock"></div>
        </div> <!-- /stock-box-csv -->
    </div> <!-- /card -->
</div> <!-- /tab-content stock -->


<!-- ==================== TAB 4: CUENTAS CORRIENTES ====================-->
<div id="cuentas" class="tab-content">
    <div class="card">
        <h2>Cuentas Corrientes</h2>
        
        <!-- Formulario para nueva cuenta -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
            <h3 style="margin-bottom: 15px; font-size: 1.2em;">‚ûï Nueva Cuenta</h3>
            <div style="display: flex; gap: 10px; align-items: end; flex-wrap: wrap;">
                <div class="form-field" style="flex: 1; min-width: 200px;">
                    <label>Nombre del Cliente *</label>
                    <input type="text" id="cuentasCliente" placeholder="Ej: Juan P√©rez">
                </div>
                <div class="form-field" style="width: 150px;">
                    <label>Tel√©fono</label>
                    <input type="text" id="cuentasTelefono" placeholder="Opcional">
                </div>
                <button class="btn-registrar" onclick="crearCuenta()" style="height: 40px;">Crear Cuenta</button>
            </div>
        </div>

        <div id="alertaCuentas" class="alert"></div>

        <!-- Mini tabs internos -->
        <div class="mini-tabs">
            <button class="mini-tab active" onclick="switchCuentasTab('activas', event)">Cuentas Activas</button>
            <button class="mini-tab" onclick="switchCuentasTab('saldadas', event)">Cuentas Saldadas</button>
        </div>

        <!-- Grid de cuentas activas -->
        <div id="cuentasActivas" class="cuentas-tab-content active">
            <div id="cuentasGridActivas"></div>
        </div>

        <!-- Grid de cuentas saldadas -->
        <div id="cuentasSaldadas" class="cuentas-tab-content">
            <div id="cuentasGridSaldadas"></div>
        </div>

        <!-- Totales generales -->
        <div id="totalesCuentas"></div>
    </div>
</div>

<!-- ==================== TAB 4b: PROMEDIOS ====================-->
 <div id="promedios" class="tab-content">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>Evoluci√≥n Mensual y Promedios</h2>
            <div style="display: flex; gap: 10px;">
                <select id="promedioAnio" onchange="cargarPromedios()" style="padding: 8px; border-radius: 6px; border: 1px solid #ddd; font-weight: bold;"></select>
                <select id="promedioMes" onchange="cargarPromedios()" style="padding: 8px; border-radius: 6px; border: 1px solid #ddd; font-weight: bold;">
                    <option value="1">Enero</option>
                    <option value="2">Febrero</option>
                    <option value="3">Marzo</option>
                    <option value="4">Abril</option>
                    <option value="5">Mayo</option>
                    <option value="6">Junio</option>
                    <option value="7">Julio</option>
                    <option value="8">Agosto</option>
                    <option value="9">Septiembre</option>
                    <option value="10">Octubre</option>
                    <option value="11">Noviembre</option>
                    <option value="12">Diciembre</option>
                </select>
                <button onclick="cargarPromedios()" class="btn" style="background: #208090; color: white;">üîÑ</button>
            </div>
        </div>

        <div class="promedios-header-grid">
            <div class="card-promedio">
                <h4>Venta Total Mes</h4>
                <div class="valor" id="promTotalMes">$0</div>
            </div>
            <div class="card-promedio">
                <h4>D√≠as Transcurridos</h4>
                <div class="valor" id="promDiasTranscurridos">0</div>
            </div>
            <div class="card-promedio" style="border-bottom: 3px solid #007bff;">
                <h4>Promedio Diario Actual</h4>
                <div class="valor" id="promPromedioActual" style="color: #007bff;">$0</div>
            </div>
            <div class="card-promedio" style="border-bottom: 3px solid #e67e22;">
                <h4>Prendas Vendidas</h4>
                <div class="valor" id="promTotalPrendas" style="color: #d35400;">0</div>
                <div style="font-size: 0.85em; color: #666; margin-top: 5px;">
                    Prom. diario: <strong id="promPromedioPrendas">0</strong>
                </div>
            </div>
             <div class="card-promedio">
                <h4>Proyecci√≥n Fin de Mes</h4>
                <div class="valor" id="promProyeccion" style="color: #aaa;">-</div>
            </div>
        </div>

        <div style="overflow-x: auto; border-radius: 8px;">
            <table class="tabla-promedios">
                <thead>
                    <tr>
                        <th style="width: 150px;">D√≠a</th>
                        <th>Venta Diaria</th>
                        <th class="col-acumulado">Acumulado Mes</th>
                        <th class="col-promedio">Promedio Diario</th>
                    </tr>
                </thead>
                <tbody id="tablaPromediosBody">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<!-------------- TAB 5 HIST√ìRICO ---------------->
<div id="historico" class="tab-content">
    <div class="card">
        <h2>Hist√≥rico y An√°lisis de Ventas</h2>

        <div class="historico-filtros">
            <div class="periodo-box">
                <label>Seleccionar a√±o</label>
                <select id="historicoAnio"></select>
            </div>
            <div class="periodo-box">
                <label>Seleccionar meses</label>
                <div class="meses-grid" id="historicoMeses">
                    </div>
            </div>
        </div>

        <button class="btn-toggle-graficos" onclick="toggleSeccionGraficos()">
            <span id="iconoGraficos">üìä</span> 
            <span>Ver An√°lisis Visual y Gr√°ficos</span>
            <span style="font-size: 0.8em; opacity: 0.7; margin-left: auto;">(Click para desplegar) ‚ñº</span>
        </button>

        <div id="seccionGraficos" class="graficos-container" style="display: none; margin-bottom: 30px;">
            <div class="graficos-selector">
                <button class="grafico-tab active" data-chart="categorias" onclick="cambiarGrafico('categorias')">
                    üè∑Ô∏è Por categor√≠a
                </button>
                <button class="grafico-tab" data-chart="tiempo" onclick="cambiarGrafico('tiempo')">
                    üìà Evoluci√≥n temporal
                </button>
                <button class="grafico-tab" data-chart="pagos" onclick="cambiarGrafico('pagos')">
                    üí≥ M√©todos de pago
                </button>
                <button class="grafico-tab" data-chart="productos" onclick="cambiarGrafico('productos')">
                    üèÜ Top productos
                </button>
            </div>
            <div class="grafico-wrapper">
                <div id="chartCategorias" class="chart-canvas active"></div>
                <div id="chartTiempo" class="chart-canvas"></div>
                <div id="chartPagos" class="chart-canvas"></div>
                <div id="chartProductos" class="chart-canvas"></div>
            </div>
        </div>

        <div class="historico-metricas">
            <div class="metric-card">
                <h4>Ventas totales</h4>
                <div class="metric-valor" id="histTotalVentas">$ 0</div>
                <div class="metric-detalle" id="histTotalTickets">0 tickets</div>
            </div>
            <div class="metric-card">
                <h4>Ticket promedio</h4>
                <div class="metric-valor" id="histTicketPromedio">$ 0</div>
                <div class="metric-detalle">por venta</div>
            </div>
            <div class="metric-card">
                <h4>Prendas vendidas</h4>
                <div class="metric-valor" id="histPrendasVendidas">0</div>
                <div class="metric-detalle">unidades</div>
            </div>
            <div class="metric-card" style="border-left: 3px solid #3498db;">
                <h4>Factura A</h4>
                <div class="metric-valor" id="histFacturaAMonto" style="color: #3498db;">$ 0</div>
                <div class="metric-detalle" id="histFacturaACant">0 tickets</div>
            </div>
            <div class="metric-card" style="border-left: 3px solid #e67e22;">
                <h4>Factura B</h4>
                <div class="metric-valor" id="histFacturaBMonto" style="color: #e67e22;">$ 0</div>
                <div class="metric-detalle" id="histFacturaBCant">0 tickets</div>
            </div>
        </div>

        <div class="historico-seccion">
            <div class="historico-seccion-header">
                <h3>Detalle de operaciones <span class="hist-periodo-label" id="histPeriodoLabel">-</span></h3>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-export" onclick="exportarHistorico('csv')" style="background: #27ae60; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                        <span>üì•</span> CSV
                    </button>
                    <button class="btn-export" onclick="exportarHistorico('excel')" style="background: #217346; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                        <span>üìä</span> Excel
                    </button>
                    <button id="btnFiltrosTabla" class="btn-toggle-filtros" onclick="toggleFiltrosTabla()">
                        <span class="icono">üîç</span> Filtros
                    </button>
                </div>
            </div>

            <div id="filtrosTablaPanel" class="filtros-panel" style="display: none;">
                <div class="filtros-grid">
                    <div class="filtro-item">
                        <label>Buscar art√≠culo</label>
                        <input type="text" id="filtroArticulo" placeholder="..." onkeyup="aplicarFiltrosTabla()">
                    </div>
                    <div class="filtro-item">
                        <label>Categor√≠a</label>
                        <select id="filtroCategoria" onchange="aplicarFiltrosTabla()">
                            <option value="">Todas</option>
                        </select>
                    </div>
                    <div class="filtro-item">
                        <label>Tipo de pago</label>
                        <select id="filtroTipoPago" onchange="aplicarFiltrosTabla()">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="filtro-item">
                        <label>Monto m√≠nimo</label>
                        <input type="number" id="filtroMontoMin" placeholder="$0" onkeyup="aplicarFiltrosTabla()">
                    </div>
                    <div class="filtro-item">
                        <label>Monto m√°ximo</label>
                        <input type="number" id="filtroMontoMax" placeholder="Sin l√≠mite" onkeyup="aplicarFiltrosTabla()">
                    </div>
                    <div class="filtro-item">
                        <label>Cantidad m√≠nima</label>
                        <input type="number" id="filtroCantidadMin" placeholder="0" onkeyup="aplicarFiltrosTabla()">
                    </div>
                </div>
                <div class="filtros-acciones">
                    <button class="btn-limpiar-filtros" onclick="limpiarFiltrosTabla()">
                        Limpiar filtros
                    </button>
                    <span id="filtrosResultado" class="filtros-resultado"></span>
                </div>
            </div>

            <div class="hist-ventas-wrapper">
                <table class="hist-ventas-tabla">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Art√≠culo</th>
                            <th>Cat.</th>
                            <th class="num">Cant.</th>
                            <th class="num">Precio</th>
                            <th class="num">Desc.</th>
                            <th class="num">Total</th>
                            <th>Pago</th>
                            <th>Fact.</th>
                        </tr>
                    </thead>
                    <tbody id="histVentasBody">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="ventas-import-mini">
            <div class="ventas-import-info">
                <h4>üì• Importar hist√≥rico</h4>
                <p>Carg√° ventas antiguas desde un archivo CSV (Formato: Fecha, Articulo, Cantidad...)</p>
            </div>
            <div>
                <button class="btn-importar-mini" onclick="document.getElementById('csvVentas').click()">
                    <span>üìÇ</span> Seleccionar Archivo
                </button>
                <input type="file" id="csvVentas" accept=".csv" onchange="uploadVentasCSV()" style="display:none;">
            </div>
        </div>
        <div id="alertaVentasCSV" class="alert"></div>

        <div class="comparativa-seccion-integrada">
            <h3 class="titulo-seccion">üìÖ Comparativa Anual de Rendimiento</h3>
            
            <div class="comparativa-controles">
                <div class="select-group">
                    <label>A√±o Base (Anterior)</label>
                    <select id="compAnio1" class="form-control-lg"></select>
                </div>
                <div class="vs-badge">VS</div>
                <div class="select-group">
                    <label>A√±o Objetivo (Actual)</label>
                    <select id="compAnio2" class="form-control-lg"></select>
                </div>
                <button onclick="cargarDataComparativa()" class="btn-comparar">
                    üìä Comparar Rendimiento
                </button>
            </div>

            <div id="resumenComparativa" class="comp-dashboard" style="display: none;">
                <div class="comp-card">
                    <h4>Facturaci√≥n Total</h4>
                    <div class="comp-grid">
                        <div class="dato-anio anterior">
                            <span id="lblAnio1_fact">-</span>
                            <div id="valAnio1_fact" class="valor">$0</div>
                        </div>
                        <div class="dato-anio actual">
                            <span id="lblAnio2_fact">-</span>
                            <div id="valAnio2_fact" class="valor">$0</div>
                        </div>
                    </div>
                    <div class="comp-footer">
                        Variaci√≥n: <span id="var_fact" class="badge-var neutral">0%</span>
                    </div>
                </div>

                <div class="comp-card">
                    <h4>Prendas Vendidas</h4>
                    <div class="comp-grid">
                        <div class="dato-anio anterior">
                            <span id="lblAnio1_unid">-</span>
                            <div id="valAnio1_unid" class="valor">0</div>
                        </div>
                        <div class="dato-anio actual">
                            <span id="lblAnio2_unid">-</span>
                            <div id="valAnio2_unid" class="valor">0</div>
                        </div>
                    </div>
                    <div class="comp-footer">
                        Variaci√≥n: <span id="var_unid" class="badge-var neutral">0%</span>
                    </div>
                </div>

                <div class="comp-card">
                    <h4>Ticket Promedio</h4>
                    <div class="comp-grid">
                        <div class="dato-anio anterior">
                            <span id="lblAnio1_ticket">-</span>
                            <div id="valAnio1_ticket" class="valor">$0</div>
                        </div>
                        <div class="dato-anio actual">
                            <span id="lblAnio2_ticket">-</span>
                            <div id="valAnio2_ticket" class="valor">$0</div>
                        </div>
                    </div>
                    <div class="comp-footer">
                        Variaci√≥n: <span id="var_ticket" class="badge-var neutral">0%</span>
                    </div>
                </div>
            </div>

            <div id="tablaComparativaContainer" style="display: none; margin-top: 30px;">
                <h4 style="margin-bottom: 15px; color: #666;">Desglose Mensual</h4>
                <div class="table-responsive">
                    <table class="comp-table">
                        <thead>
                            <tr>
                                <th>Mes</th>
                                <th class="text-right border-left">Facturaci√≥n <span id="thAnio1"></span></th>
                                <th class="text-right">Facturaci√≥n <span id="thAnio2"></span></th>
                                <th class="text-center">Variaci√≥n $</th>
                                <th class="text-right border-left">Unidades <span id="thAnio1_u"></span></th>
                                <th class="text-right">Unidades <span id="thAnio2_u"></span></th>
                                <th class="text-center">Variaci√≥n Unid.</th>
                            </tr>
                        </thead>
                        <tbody id="bodyComparativa"></tbody>
                    </table>
                </div>
            </div>
        </div>
        </div> </div>

<script src="app.js"></script>


<div id="toast" class="toast"></div>

<div id="modalCtaCte" class="admin-modal" style="z-index: 2000;">
    <div class="admin-modal-content" style="max-width: 400px;">
        <div class="admin-modal-header" style="background: #e67e22;">
            <h2>üë§ Datos del Cliente</h2>
            <button class="admin-modal-close" onclick="cerrarModalCtaCte()">√ó</button>
        </div>
        <div class="admin-modal-body">
            <div class="form-group">
                <label>Nombre y Apellido *</label>
                <input type="text" id="ccNombre" placeholder="Ej: Lionel Messi" autofocus>
            </div>
            <div class="form-group">
                <label>Tel√©fono</label>
                <input type="text" id="ccTelefono" placeholder="Ej: 11 1234-5678">
            </div>
            <div class="form-group">
                <label>Art√≠culo de Inter√©s / Devuelto</label>
                <input type="text" id="ccArticulo" placeholder="Ej: Jeans 505 (Cambio)">
            </div>
            <div class="form-group">
                <label>Comentarios de la Cuenta</label>
                <textarea id="ccComentarios" rows="2" style="width: 100%; border: 1px solid #ddd; border-radius: 6px; padding: 8px;" placeholder="Detalles extra..."></textarea>
            </div>
            <button class="btn-full" onclick="confirmarVentaCtaCte()" style="background: #e67e22; color: white; margin-top: 10px; font-weight: bold; padding: 12px;">
                Confirmar y Registrar
            </button>
        </div>
    </div>
</div>

<div id="modalNuevoProducto" class="admin-modal" style="z-index: 2000;">
    <div class="admin-modal-content">
        <div class="admin-modal-header" style="background: #27ae60;">
            <h2>‚ú® Nuevo Art√≠culo</h2>
            <button class="admin-modal-close" onclick="cerrarModalProducto()">√ó</button>
        </div>
        <div class="admin-modal-body">
            <div class="form-group">
                <label>C√≥digo *</label>
                <input type="text" id="npCodigo" placeholder="Ej: REMERA-001" style="font-weight: bold;">
            </div>
            <div class="form-group">
                <label>Descripci√≥n *</label>
                <input type="text" id="npDescripcion" placeholder="Ej: Remera Algod√≥n Negra">
            </div>
            <div class="form-group">
                <label>Categor√≠a</label>
                <input type="text" id="npCategoria" placeholder="Ej: REMERAS">
            </div>
            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex: 1;">
                    <label>Precio P√∫blico</label>
                    <input type="number" id="npPrecio" step="0.01" value="0">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Costo</label>
                    <input type="number" id="npCosto" step="0.01" value="0">
                </div>
            </div>
            <div class="form-group">
                <label>Stock Inicial</label>
                <input type="number" id="npStock" value="0">
            </div>
            
            <button class="btn-guardar-modal" onclick="guardarNuevoProducto()">
                üíæ Guardar Producto
            </button>
        </div>
    </div>
</div>

</body>
</html>